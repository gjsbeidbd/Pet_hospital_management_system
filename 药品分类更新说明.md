# 药品数据库重构说明

## 更新时间
2025-11-11

## 更新内容

### 1. 数据库结构优化 (pet_hospital.sql)

#### 新增字段
- `category` - 药品分类（ENUM类型，12个分类）
  - 抗寄生虫_体内
  - 抗寄生虫_体外
  - 抗寄生虫_广谱
  - 皮肤与耳道用药
  - 抗感染_抗生素
  - 消化道用药
  - 镇痛与麻醉
  - 心血管用药
  - 呼吸系统用药
  - 眼科用药
  - 解毒与支持治疗
  - 营养与代谢

- `usage_instructions` - 用法用量（TEXT）
- `contraindications` - 禁忌症（TEXT）
- `applicable_cat` - 适用于猫（TINYINT: 0-不适用, 1-适用）
- `applicable_dog` - 适用于狗（TINYINT: 0-不适用, 1-适用）
- `applicable_bird` - 适用于鸟（TINYINT: 0-不适用, 1-适用）
- `applicable_rabbit` - 适用于兔子（TINYINT: 0-不适用, 1-适用）
- `applicable_hamster` - 适用于仓鼠（TINYINT: 0-不适用, 1-适用）

#### 示例数据
更新了52条示例药品数据，涵盖12个分类，每个分类包含2-4个代表性药品：
- 每个药品都标注了详细的用法用量和禁忌症
- 根据物种特点标记了适用性（例如：卡洛芬片只适用于狗，猫禁用）
- 特别注意了物种差异（如维生素C对豚鼠和鸟类是必需的）

### 2. 后端实体类更新 (Medicine.java)

新增属性：
```java
private String category;                // 药品分类
private String usageInstructions;       // 用法用量
private String contraindications;       // 禁忌症
private Integer applicableCat;          // 适用于猫
private Integer applicableDog;          // 适用于狗
private Integer applicableBird;         // 适用于鸟
private Integer applicableRabbit;       // 适用于兔子
private Integer applicableHamster;      // 适用于仓鼠
```

所有新增字段都配备了完整的getter和setter方法。

### 3. 前端界面优化 (InventoryManagement.vue)

#### 新增功能

1. **分类筛选下拉框**
   - 支持按12个药品分类筛选
   - 可清除筛选条件显示全部

2. **物种筛选下拉框**
   - 支持按5个物种（猫、狗、鸟、兔子、仓鼠）筛选
   - 只显示适用于该物种的药品

3. **药品列表增强**
   - 新增"分类"列，显示药品分类
   - 新增"适用物种"列，用不同颜色的标签显示
     - 猫：默认蓝色
     - 狗：绿色
     - 鸟：黄色
     - 兔：灰色
     - 仓鼠：红色

4. **添加/编辑表单优化**
   - 分类改为下拉选择，必填项
   - 新增"适用物种"复选框组，可多选
   - 新增"用法用量"文本域
   - 新增"禁忌症"文本域

5. **详情对话框增强**
   - 显示药品分类（格式化显示）
   - 显示适用物种标签
   - 显示用法用量信息
   - 显示禁忌症信息

#### 数据处理逻辑

- **提交表单时**：将适用物种数组（如['cat', 'dog']）转换为5个独立的字段（applicableCat=1, applicableDog=1等）
- **编辑时回显**：将5个字段转换为数组形式，便于复选框显示
- **多条件筛选**：支持同时按分类、物种、名称进行筛选

### 4. 物种用药注意事项（已集成到数据中）

#### 猫
- ❌ 严禁：对乙酰氨基酚、阿司匹林、卡洛芬
- ✅ 推荐镇痛：丁丙诺啡、美洛昔康
- ✅ 皮肤癣：酮康唑、克霉唑、伊曲康唑

#### 狗
- ⚠️ 慎用：对乙酰氨基酚（不推荐）
- ✅ 推荐镇痛：卡洛芬、美洛昔康、氟尼辛葡甲胺
- ✅ 驱虫：吡喹酮、阿苯达唑、非泼罗尼

#### 鸟
- ⚠️ 体外寄生虫：需使用鸟类专用伊维菌素制剂
- ⚠️ 许多人用药对鸟类不安全，务必使用鸟类专用制剂
- ✅ 必需营养素：维生素C

#### 兔子
- ✅ 皮肤/耳螨：伊维菌素外用
- ✅ 消化道：蒙脱石散、碱式水杨酸铋、益生菌
- ✅ 必需营养素：维生素C
- ⚠️ 避免随意使用NSAIDs

#### 仓鼠
- ✅ 常备：生理盐水、葡萄糖、蒙脱石散、益生菌、金霉素眼膏
- ⚠️ 体外寄生虫：伊维菌素滴剂（选择仓鼠规格）
- ❌ 避免：人用复方感冒药、阿司匹林
- ⚠️ 所有用药需按体重精确计量

## 使用说明

### 重新初始化数据库

```bash
# 在MySQL中执行
mysql -u root -p < pet_hospital.sql
```

### 后端
无需额外配置，MyBatis Plus会自动映射新字段。

### 前端
1. 重启前端开发服务器
2. 访问院长界面 -> 库存管理
3. 可使用分类和物种筛选功能

## 数据完整性

✅ 所有52个药品都包含：
- 完整的分类信息
- 详细的用法用量
- 明确的禁忌症说明
- 准确的适用物种标记

## 兼容性说明

- 旧版本药品数据已完全替换
- 所有新增字段都有默认值，不影响现有功能
- 前端向后兼容，即使后端未更新也能正常显示（字段为空时显示"-"）

## 注意事项

1. **重要**：请在测试环境验证后再部署到生产环境
2. 建议备份原有数据库
3. 如需保留旧数据，请手动为旧数据补充category和适用物种字段
4. 新增药品时，分类和适用物种为必填项

## 技术实现亮点

1. **数据规范化**：使用ENUM类型严格控制分类选项
2. **灵活筛选**：支持单一或组合条件筛选
3. **用户友好**：标签颜色区分、格式化显示
4. **数据完整**：包含用法用量和禁忌症，符合医疗规范
5. **物种安全**：通过适用性标记避免用药错误
