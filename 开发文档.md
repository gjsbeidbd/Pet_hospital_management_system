# 宠物医院信息管理系统开发文档

## 1. 系统概述

宠物医院信息管理系统是一个专门为宠物医院设计的综合管理平台，旨在提高医院运营效率，优化客户体验，简化医生工作流程，并为管理层提供数据分析支持。

### 1.1 系统目标
- 为宠物主人提供便捷的预约服务和宠物健康管理功能
- 为前台工作人员提供客户和宠物档案管理、预约挂号、收费结算等功能
- 为医生提供排班查看、接诊管理、病例记录等功能
- 为院长提供全面的数据统计和报表分析功能

### 1.2 技术架构
- 前端层：Vue.js
- 业务逻辑层：Spring Boot后端RESTful API接口
- 数据访问层：MyBatis/MyBatis Plus + 数据库连接池
- 数据存储层：MySQL

## 2. 功能模块设计

### 2.1 用户管理模块

#### 2.1.1 登录和注册
- 用户注册：新用户可以通过手机号或邮箱注册账户
- 用户登录：已注册用户可通过手机号或邮箱及密码登录系统
- 身份验证：JWT Token验证用户身份
- 角色权限控制：根据用户角色类别分配不同权限，登录成功后跳转到相应角色的主页面
- 个人信息完善：注册时仅需提供手机号/邮箱和密码，真实姓名等详细信息在登录后个人资料中完善

##### 关键代码示例

后端登录接口示例：
```java
@RestController
@RequestMapping("/api/auth")
public class AuthController {

    @Autowired
    private UserService userService;

    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest loginRequest) {
        try {
            Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                    loginRequest.getUsername(),
                    loginRequest.getPassword()
                )
            );
            
            String token = jwtTokenProvider.generateToken(authentication);
            User user = userService.findByUsername(loginRequest.getUsername());
            
            LoginResponse response = new LoginResponse();
            response.setToken(token);
            response.setRole(user.getRole());
            response.setUserId(user.getId());
            
            return ResponseEntity.ok(response);
        } catch (AuthenticationException e) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("登录失败");
        }
    }
}
```

前端登录处理示例：
```
// 登录方法
const login = async (username, password) => {
  try {
    const response = await axios.post('/api/auth/login', { username, password });
    const { token, role } = response.data;
    
    // 存储token
    localStorage.setItem('token', token);
    
    // 根据角色跳转到不同页面
    switch(role) {
      case 'USER':
        router.push('/user/dashboard');
        break;
      case 'RECEPTIONIST':
        router.push('/receptionist/dashboard');
        break;
      case 'DOCTOR':
        router.push('/doctor/dashboard');
        break;
      case 'ADMIN':
        router.push('/director/dashboard');
        break;
      default:
        router.push('/');
    }
    
    return { success: true };
  } catch (error) {
    return { success: false, message: '登录失败' };
  }
};
```

#### 2.1.2 预约功能
- 在线预约：用户可以选择医生、时间进行预约
- 预约查询：用户可以查看自己的预约记录
- 预约修改：用户可以修改或取消预约

##### 关键代码示例

后端预约接口示例：
```java
@RestController
@RequestMapping("/api/appointments")
@PreAuthorize("hasRole('USER')")
public class AppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @PostMapping
    public ResponseEntity<?> createAppointment(@RequestBody AppointmentRequest request) {
        try {
            Appointment appointment = appointmentService.createAppointment(request);
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约失败: " + e.getMessage());
        }
    }

    @GetMapping("/user/{userId}")
    public ResponseEntity<?> getUserAppointments(@PathVariable Long userId) {
        List<Appointment> appointments = appointmentService.getUserAppointments(userId);
        return ResponseEntity.ok(appointments);
    }
}
```

前端预约组件示例：
``vue
<template>
  <div class="appointment-form">
    <el-form :model="appointmentForm" label-width="120px">
      <el-form-item label="选择宠物">
        <el-select v-model="appointmentForm.petId" placeholder="请选择宠物">
          <el-option
            v-for="pet in pets"
            :key="pet.id"
            :label="pet.name"
            :value="pet.id">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="选择医生">
        <el-select v-model="appointmentForm.doctorId" placeholder="请选择医生">
          <el-option
            v-for="doctor in doctors"
            :key="doctor.id"
            :label="doctor.name"
            :value="doctor.id">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="预约时间">
        <el-date-picker
          v-model="appointmentForm.appointmentTime"
          type="datetime"
          placeholder="选择日期时间">
        </el-date-picker>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="submitAppointment">提交预约</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      appointmentForm: {
        petId: '',
        doctorId: '',
        appointmentTime: ''
      },
      pets: [],
      doctors: []
    };
  },
  
  methods: {
    async submitAppointment() {
      try {
        const response = await axios.post('/api/appointments', this.appointmentForm);
        this.$message.success('预约成功');
        this.$router.push('/user/appointments');
      } catch (error) {
        this.$message.error('预约失败: ' + error.response.data);
      }
    }
  }
};
</script>
```

#### 2.1.3 个人宠物既往病例查看
- 宠物档案：用户可以查看自己宠物的基本信息
- 病例查看：用户可以查看宠物的历史就诊记录和病例详情

##### 关键代码示例

后端病例查询接口示例：
```java
@RestController
@RequestMapping("/api/medical-records")
@PreAuthorize("hasRole('USER')")
public class MedicalRecordController {

    @Autowired
    private MedicalRecordService medicalRecordService;

    @GetMapping("/pet/{petId}")
    public ResponseEntity<?> getPetMedicalRecords(@PathVariable Long petId) {
        List<MedicalRecord> records = medicalRecordService.getPetMedicalRecords(petId);
        return ResponseEntity.ok(records);
    }
}
```

前端病例展示组件示例：
``vue
<template>
  <div class="medical-records">
    <el-table :data="medicalRecords" style="width: 100%">
      <el-table-column prop="visitDate" label="就诊日期" width="180"></el-table-column>
      <el-table-column prop="symptoms" label="症状" width="200"></el-table-column>
      <el-table-column prop="diagnosis" label="诊断结果"></el-table-column>
      <el-table-column prop="treatment" label="治疗方案"></el-table-column>
      <el-table-column label="操作" width="100">
        <template #default="scope">
          <el-button @click="viewDetail(scope.row.id)" type="text">查看详情</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      medicalRecords: []
    };
  },
  
  async mounted() {
    await this.loadMedicalRecords();
  },
  
  methods: {
    async loadMedicalRecords() {
      try {
        const petId = this.$route.params.petId;
        const response = await axios.get(`/api/medical-records/pet/${petId}`);
        this.medicalRecords = response.data;
      } catch (error) {
        this.$message.error('加载病例失败');
      }
    },
    
    viewDetail(recordId) {
      this.$router.push(`/user/medical-record/${recordId}`);
    }
  }
};
</script>
```

### 2.2 前台管理模块

#### 2.2.1 客户与宠物档案管理
- 客户信息管理：维护客户基本信息、联系方式等
- 宠物档案管理：维护宠物基本信息、品种、年龄、疫苗记录等

##### 关键代码示例

后端客户管理接口示例：
```java
@RestController
@RequestMapping("/api/customers")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class CustomerController {

    @Autowired
    private CustomerService customerService;

    @GetMapping
    public ResponseEntity<?> getAllCustomers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<Customer> customers = customerService.getAllCustomers(PageRequest.of(page, size));
        return ResponseEntity.ok(customers);
    }

    @PostMapping
    public ResponseEntity<?> createCustomer(@RequestBody Customer customer) {
        Customer savedCustomer = customerService.saveCustomer(customer);
        return ResponseEntity.ok(savedCustomer);
    }

    @PutMapping("/{id}")
    public ResponseEntity<?> updateCustomer(@PathVariable Long id, @RequestBody Customer customer) {
        Customer updatedCustomer = customerService.updateCustomer(id, customer);
        return ResponseEntity.ok(updatedCustomer);
    }
}
```

前端客户管理界面示例：
``vue
<template>
  <div class="customer-management">
    <el-card>
      <div slot="header">
        <span>客户档案管理</span>
        <el-button style="float: right;" type="primary" @click="showAddForm">新增客户</el-button>
      </div>
      
      <el-table :data="customers" style="width: 100%">
        <el-table-column prop="realName" label="姓名" width="120"></el-table-column>
        <el-table-column prop="phone" label="电话" width="150"></el-table-column>
        <el-table-column prop="email" label="邮箱" width="200"></el-table-column>
        <el-table-column label="操作">
          <template #default="scope">
            <el-button size="mini" @click="editCustomer(scope.row)">编辑</el-button>
            <el-button size="mini" type="danger" @click="deleteCustomer(scope.row.id)">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        :current-page="currentPage"
        :page-sizes="[10, 20, 50]"
        :page-size="pageSize"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total">
      </el-pagination>
    </el-card>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      customers: [],
      currentPage: 1,
      pageSize: 10,
      total: 0
    };
  },
  
  mounted() {
    this.loadCustomers();
  },
  
  methods: {
    async loadCustomers() {
      try {
        const response = await axios.get(`/api/customers?page=${this.currentPage - 1}&size=${this.pageSize}`);
        this.customers = response.data.content;
        this.total = response.data.totalElements;
      } catch (error) {
        this.$message.error('加载客户数据失败');
      }
    },
    
    handleSizeChange(val) {
      this.pageSize = val;
      this.loadCustomers();
    },
    
    handleCurrentChange(val) {
      this.currentPage = val;
      this.loadCustomers();
    }
  }
};
</script>
```

#### 2.2.2 预约挂号管理
- 预约登记：为现场客户提供预约服务
- 预约调整：修改预约时间或医生
- 预约取消：处理客户取消预约请求

##### 关键代码示例

后端预约管理接口示例：
```java
@RestController
@RequestMapping("/api/receptionist/appointments")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class ReceptionistAppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @PostMapping
    public ResponseEntity<?> createAppointment(@RequestBody AppointmentRequest request) {
        try {
            Appointment appointment = appointmentService.createAppointmentByReceptionist(request);
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约登记失败: " + e.getMessage());
        }
    }

    @PutMapping("/{id}/reschedule")
    public ResponseEntity<?> rescheduleAppointment(@PathVariable Long id, @RequestBody RescheduleRequest request) {
        try {
            Appointment appointment = appointmentService.rescheduleAppointment(id, request.getNewTime());
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约调整失败: " + e.getMessage());
        }
    }

    @DeleteMapping("/{id}/cancel")
    public ResponseEntity<?> cancelAppointment(@PathVariable Long id) {
        try {
            appointmentService.cancelAppointment(id);
            return ResponseEntity.ok("预约已取消");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("取消预约失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.3 收费结算
- 费用计算：根据诊疗项目和药品自动生成费用清单
- 收费处理：支持多种支付方式（现金、刷卡、移动支付）
- 发票打印：生成并打印收费发票

##### 关键代码示例

后端收费接口示例：
```java
@RestController
@RequestMapping("/api/billing")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class BillingController {

    @Autowired
    private BillingService billingService;

    @PostMapping
    public ResponseEntity<?> createBill(@RequestBody BillingRequest request) {
        try {
            Billing bill = billingService.createBill(request);
            return ResponseEntity.ok(bill);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("创建账单失败: " + e.getMessage());
        }
    }

    @PostMapping("/{id}/pay")
    public ResponseEntity<?> processPayment(
        @PathVariable Long id, 
        @RequestBody PaymentRequest request) {
        try {
            Billing updatedBill = billingService.processPayment(id, request);
            return ResponseEntity.ok(updatedBill);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("支付处理失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.4 药品出入库登记
- 入库登记：记录药品采购信息
- 出库登记：记录药品使用或销售信息
- 库存更新：实时更新药品库存数量

##### 关键代码示例

后端药品库存管理接口示例：
```java
@RestController
@RequestMapping("/api/medicine-inventory")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class MedicineInventoryController {

    @Autowired
    private MedicineInventoryService inventoryService;

    @PostMapping("/inbound")
    public ResponseEntity<?> recordInbound(@RequestBody InboundRequest request) {
        try {
            inventoryService.recordInbound(request);
            return ResponseEntity.ok("入库登记成功");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("入库登记失败: " + e.getMessage());
        }
    }

    @PostMapping("/outbound")
    public ResponseEntity<?> recordOutbound(@RequestBody OutboundRequest request) {
        try {
            inventoryService.recordOutbound(request);
            return ResponseEntity.ok("出库登记成功");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("出库登记失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.5 预约提醒与客户通知
- 短信提醒：在预约前一天发送提醒短信
- 电话通知：重要事项电话通知客户
- 系统提醒：在系统内发送站内信提醒

##### 关键代码示例

定时任务发送提醒示例：
```java
@Component
public class AppointmentReminderService {

    @Autowired
    private AppointmentRepository appointmentRepository;
    
    @Autowired
    private NotificationService notificationService;

    @Scheduled(cron = "0 0 9 * * ?") // 每天上午9点执行
    public void sendAppointmentReminders() {
        LocalDate tomorrow = LocalDate.now().plusDays(1);
        List<Appointment> appointments = appointmentRepository
            .findByAppointmentTimeBetween(
                tomorrow.atStartOfDay(), 
                tomorrow.atTime(23, 59, 59));
        
        for (Appointment appointment : appointments) {
            // 发送短信提醒
            notificationService.sendSmsReminder(appointment);
            
            // 发送系统提醒
            notificationService.sendSystemNotification(appointment);
        }
    }
}
```

### 2.3 医生管理模块

#### 2.3.1 我的排班
- 排班查看：医生可以查看个人排班时间表
- 排班调整申请：医生可以申请调整排班时间

##### 关键代码示例

后端排班管理接口示例：
```java
@RestController
@RequestMapping("/api/doctor/schedule")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorScheduleController {

    @Autowired
    private DoctorScheduleService scheduleService;

    @GetMapping
    public ResponseEntity<?> getMySchedule(Authentication authentication) {
        User currentUser = (User) authentication.getPrincipal();
        List<Schedule> schedules = scheduleService.getDoctorSchedules(currentUser.getId());
        return ResponseEntity.ok(schedules);
    }

    @PostMapping("/request-change")
    public ResponseEntity<?> requestScheduleChange(@RequestBody ScheduleChangeRequest request) {
        try {
            scheduleService.requestScheduleChange(request);
            return ResponseEntity.ok("排班调整申请已提交");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("申请提交失败: " + e.getMessage());
        }
    }
}
```

#### 2.3.2 接诊与病理管理
- 接诊处理：医生可以查看当日预约患者并进行接诊
- 病理记录：记录诊断结果、治疗方案等信息

##### 关键代码示例

后端接诊接口示例：
```java
@RestController
@RequestMapping("/api/doctor/consultation")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorConsultationController {

    @Autowired
    private ConsultationService consultationService;

    @GetMapping("/today")
    public ResponseEntity<?> getTodayAppointments(Authentication authentication) {
        User currentUser = (User) authentication.getPrincipal();
        List<Appointment> appointments = consultationService.getDoctorTodayAppointments(currentUser.getId());
        return ResponseEntity.ok(appointments);
    }

    @PostMapping("/record")
    public ResponseEntity<?> recordConsultation(@RequestBody ConsultationRecordRequest request) {
        try {
            MedicalRecord record = consultationService.recordConsultation(request);
            return ResponseEntity.ok(record);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("记录失败: " + e.getMessage());
        }
    }
}
```

#### 2.3.3 处方与药品关联
- 处方开具：医生可以为患者开具电子处方
- 药品关联：处方自动关联所需药品和剂量

##### 关键代码示例

后端处方管理接口示例：
```java
@RestController
@RequestMapping("/api/doctor/prescription")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorPrescriptionController {

    @Autowired
    private PrescriptionService prescriptionService;

    @PostMapping
    public ResponseEntity<?> createPrescription(@RequestBody PrescriptionRequest request) {
        try {
            Prescription prescription = prescriptionService.createPrescription(request);
            return ResponseEntity.ok(prescription);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("处方开具失败: " + e.getMessage());
        }
    }

    @GetMapping("/medical-record/{recordId}")
    public ResponseEntity<?> getPrescriptionsByMedicalRecord(@PathVariable Long recordId) {
        List<Prescription> prescriptions = prescriptionService.getByMedicalRecordId(recordId);
        return ResponseEntity.ok(prescriptions);
    }
}
```

#### 2.3.4 历史病例查阅
- 病例查询：医生可以查询历史病例记录
- 病例对比：可以对比同一宠物多次就诊记录

##### 关键代码示例

后端病例查询接口示例：
```java
@RestController
@RequestMapping("/api/doctor/medical-records")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorMedicalRecordController {

    @Autowired
    private MedicalRecordService medicalRecordService;

    @GetMapping("/pet/{petId}")
    public ResponseEntity<?> getPetMedicalHistory(@PathVariable Long petId) {
        List<MedicalRecord> records = medicalRecordService.getPetMedicalHistory(petId);
        return ResponseEntity.ok(records);
    }

    @GetMapping("/compare")
    public ResponseEntity<?> compareMedicalRecords(@RequestParam List<Long> recordIds) {
        List<MedicalRecord> records = medicalRecordService.compareRecords(recordIds);
        return ResponseEntity.ok(records);
    }
}
```

#### 2.3.5 预约列表
- 当日预约：查看当日所有预约信息
- 预约状态更新：更新预约就诊状态

##### 关键代码示例

前端预约列表组件示例：
``vue
<template>
  <div class="appointment-list">
    <el-card>
      <div slot="header">
        <span>今日预约列表</span>
      </div>
      
      <el-table :data="appointments" style="width: 100%">
        <el-table-column prop="petName" label="宠物名称" width="120"></el-table-column>
        <el-table-column prop="ownerName" label="主人姓名" width="120"></el-table-column>
        <el-table-column prop="appointmentTime" label="预约时间" width="180"></el-table-column>
        <el-table-column prop="status" label="状态" width="100">
          <template #default="scope">
            <el-tag :type="getStatusTagType(scope.row.status)">
              {{ getStatusText(scope.row.status) }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column label="操作">
          <template #default="scope">
            <el-button 
              size="mini" 
              @click="updateStatus(scope.row.id, 'CONFIRMED')" 
              :disabled="scope.row.status !== 'PENDING'">
              接诊
            </el-button>
            <el-button 
              size="mini" 
              type="success" 
              @click="updateStatus(scope.row.id, 'COMPLETED')" 
              :disabled="scope.row.status !== 'CONFIRMED'">
              完成
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      appointments: []
    };
  },
  
  mounted() {
    this.loadTodayAppointments();
  },
  
  methods: {
    async loadTodayAppointments() {
      try {
        const response = await axios.get('/api/doctor/consultation/today');
        this.appointments = response.data;
      } catch (error) {
        this.$message.error('加载预约列表失败');
      }
    },
    
    async updateStatus(appointmentId, status) {
      try {
        await axios.put(`/api/appointments/${appointmentId}/status`, { status });
        this.$message.success('状态更新成功');
        this.loadTodayAppointments();
      } catch (error) {
        this.$message.error('状态更新失败');
      }
    },
    
    getStatusTagType(status) {
      const statusMap = {
        'PENDING': '',
        'CONFIRMED': 'warning',
        'COMPLETED': 'success',
        'CANCELLED': 'danger'
      };
      return statusMap[status] || '';
    },
    
    getStatusText(status) {
      const statusTextMap = {
        'PENDING': '待接诊',
        'CONFIRMED': '已接诊',
        'COMPLETED': '已完成',
        'CANCELLED': '已取消'
      };
      return statusTextMap[status] || status;
    }
  }
};
</script>
```

### 2.4 院长管理模块

#### 2.4.1 用户管理
- 用户权限管理：管理不同角色用户的权限
- 用户信息维护：维护系统所有用户的基本信息

##### 关键代码示例

后端用户管理接口示例：
``java
@RestController
@RequestMapping("/api/director/users")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorUserController {

    @Autowired
    private UserService userService;

    @GetMapping
    public ResponseEntity<?> getAllUsers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<User> users = userService.getAllUsers(PageRequest.of(page, size));
        return ResponseEntity.ok(users);
    }

    @PutMapping("/{id}/role")
    public ResponseEntity<?> updateUserRole(
        @PathVariable Long id, 
        @RequestBody UpdateRoleRequest request) {
        try {
            User updatedUser = userService.updateUserRole(id, request.getRole());
            return ResponseEntity.ok(updatedUser);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("更新用户角色失败: " + e.getMessage());
        }
    }
}
```

#### 2.4.2 客户与宠物归档
- 客户档案管理：查看和管理所有客户档案
- 宠物档案管理：查看和管理所有宠物档案

##### 关键代码示例

后端档案管理接口示例：
``java
@RestController
@RequestMapping("/api/director/archive")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorArchiveController {

    @Autowired
    private ArchiveService archiveService;

    @GetMapping("/customers")
    public ResponseEntity<?> getAllCustomers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<CustomerArchive> customers = archiveService.getAllCustomers(PageRequest.of(page, size));
        return ResponseEntity.ok(customers);
    }

    @GetMapping("/pets")
    public ResponseEntity<?> getAllPets(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<PetArchive> pets = archiveService.getAllPets(PageRequest.of(page, size));
        return ResponseEntity.ok(pets);
    }
}
```

#### 2.4.3 预约管理
- 全院预约查看：查看全院所有预约情况
- 预约统计分析：统计预约相关数据

##### 关键代码示例

后端预约统计接口示例：
``java
@RestController
@RequestMapping("/api/director/appointments")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorAppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @GetMapping
    public ResponseEntity<?> getAllAppointments(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<Appointment> appointments = appointmentService.getAllAppointments(PageRequest.of(page, size));
        return ResponseEntity.ok(appointments);
    }

    @GetMapping("/statistics")
    public ResponseEntity<?> getAppointmentStatistics(
        @RequestParam(required = false) LocalDate startDate,
        @RequestParam(required = false) LocalDate endDate) {
        AppointmentStatistics statistics = appointmentService.getStatistics(startDate, endDate);
        return ResponseEntity.ok(statistics);
    }
}
```

#### 2.4.4 电子病例
- 病例审核：审核医生提交的电子病例
- 病例归档：将已完成病例进行归档管理

##### 关键代码示例

后端病例管理接口示例：
``java
@RestController
@RequestMapping("/api/director/medical-records")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorMedicalRecordController {

    @Autowired
    private MedicalRecordService medicalRecordService;

    @GetMapping("/pending-review")
    public ResponseEntity<?> getPendingReviewRecords() {
        List<MedicalRecord> records = medicalRecordService.getPendingReviewRecords();
        return ResponseEntity.ok(records);
    }

    @PutMapping("/{id}/review")
    public ResponseEntity<?> reviewMedicalRecord(
        @PathVariable Long id, 
        @RequestBody ReviewRequest request) {
        try {
            MedicalRecord reviewedRecord = medicalRecordService.reviewRecord(id, request);
            return ResponseEntity.ok(reviewedRecord);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("审核失败: " + e.getMessage());
        }
    }
}
```

#### 2.4.5 收费结算
- 收费监管：查看所有收费记录
- 退款处理：处理客户退款申请

##### 关键代码示例

后端收费管理接口示例：
``java
@RestController
@RequestMapping("/api/director/billing")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorBillingController {

    @Autowired
    private BillingService billingService;

    @GetMapping
    public ResponseEntity<?> getAllBillingRecords(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<Billing> bills = billingService.getAllBills(PageRequest.of(page, size));
        return ResponseEntity.ok(bills);
    }

    @PostMapping("/{id}/refund")
    public ResponseEntity<?> processRefund(
        @PathVariable Long id, 
        @RequestBody RefundRequest request) {
        try {
            Billing updatedBill = billingService.processRefund(id, request);
            return ResponseEntity.ok(updatedBill);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("退款处理失败: " + e.getMessage());
        }
    }
}
```

#### 2.4.6 药品库存管理
- 库存监控：实时监控药品库存情况
- 采购建议：根据库存情况提供采购建议

##### 关键代码示例

后端库存管理接口示例：
``java
@RestController
@RequestMapping("/api/director/inventory")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorInventoryController {

    @Autowired
    private InventoryService inventoryService;

    @GetMapping("/medicines")
    public ResponseEntity<?> getAllMedicines(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<Medicine> medicines = inventoryService.getAllMedicines(PageRequest.of(page, size));
        return ResponseEntity.ok(medicines);
    }

    @GetMapping("/low-stock")
    public ResponseEntity<?> getLowStockMedicines() {
        List<Medicine> lowStockMedicines = inventoryService.getLowStockMedicines();
        return ResponseEntity.ok(lowStockMedicines);
    }

    @GetMapping("/purchase-suggestions")
    public ResponseEntity<?> getPurchaseSuggestions() {
        List<PurchaseSuggestion> suggestions = inventoryService.getPurchaseSuggestions();
        return ResponseEntity.ok(suggestions);
    }
}
```

#### 2.4.7 统计报表
- 营收报表：生成营业收入相关报表
- 业务统计：统计各类业务数据
- 医生绩效：统计医生工作量和绩效

##### 关键代码示例

后端报表接口示例：
```java
@RestController
@RequestMapping("/api/director/reports")
@PreAuthorize("hasRole('ADMIN')")
public class DirectorReportController {

    @Autowired
    private ReportService reportService;

    @GetMapping("/revenue")
    public ResponseEntity<?> getRevenueReport(
        @RequestParam(required = false) LocalDate startDate,
        @RequestParam(required = false) LocalDate endDate) {
        RevenueReport report = reportService.generateRevenueReport(startDate, endDate);
        return ResponseEntity.ok(report);
    }

    @GetMapping("/business-statistics")
    public ResponseEntity<?> getBusinessStatistics(
        @RequestParam(required = false) LocalDate startDate,
        @RequestParam(required = false) LocalDate endDate) {
        BusinessStatistics statistics = reportService.generateBusinessStatistics(startDate, endDate);
        return ResponseEntity.ok(statistics);
    }

    @GetMapping("/doctor-performance")
    public ResponseEntity<?> getDoctorPerformance(
        @RequestParam(required = false) LocalDate startDate,
        @RequestParam(required = false) LocalDate endDate) {
        List<DoctorPerformance> performance = reportService.calculateDoctorPerformance(startDate, endDate);
        return ResponseEntity.ok(performance);
    }
}
```

## 3. 技术实现方案

### 3.1 前端技术栈
- Vue.js 3：构建用户界面的渐进式框架
- Vite：快速的构建工具
- Vue Router：实现路由管理
- Pinia：状态管理
- Element Plus：UI组件库
- Vue Router权限控制：根据用户角色动态加载路由和控制页面访问权限

### 3.2 后端技术栈
- Spring Boot：简化Spring应用的初始搭建以及开发过程
- Spring Security：提供安全认证和授权
- MyBatis/MyBatis Plus：数据持久层框架
- JWT：Token认证机制
- MySQL：关系型数据库
- Spring Security权限控制：基于角色的访问控制(RBAC)，实现不同角色的API访问权限控制

### 3.3 数据库设计

### 3.3.1 用户表 (users)
```sql
CREATE TABLE users (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID',
  username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
  password VARCHAR(100) NOT NULL COMMENT '密码',
  role ENUM('USER', 'RECEPTIONIST', 'DOCTOR', 'ADMIN') NOT NULL COMMENT '角色',
  real_name VARCHAR(50) NOT NULL COMMENT '真实姓名',
  phone VARCHAR(20) COMMENT '联系电话',
  email VARCHAR(100) COMMENT '邮箱',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT '用户表';
```

### 3.3.2 宠物表 (pets)
```sql
CREATE TABLE pets (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '宠物ID',
  owner_id BIGINT NOT NULL COMMENT '主人ID',
  name VARCHAR(50) NOT NULL COMMENT '宠物名称',
  species VARCHAR(50) COMMENT '种类',
  breed VARCHAR(50) COMMENT '品种',
  age INT COMMENT '年龄',
  gender ENUM('MALE', 'FEMALE') COMMENT '性别',
  weight DECIMAL(5,2) COMMENT '体重',
  birthday DATE COMMENT '出生日期',
  vaccination_status TEXT COMMENT '疫苗接种情况',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (owner_id) REFERENCES users(id)
) COMMENT '宠物表';
```

### 3.3.3 医生表 (doctors)
```sql
CREATE TABLE doctors (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '医生ID',
  user_id BIGINT NOT NULL COMMENT '用户ID',
  department VARCHAR(50) COMMENT '科室',
  title VARCHAR(50) COMMENT '职称',
  specialty TEXT COMMENT '专长',
  description TEXT COMMENT '简介',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (user_id) REFERENCES users(id)
) COMMENT '医生表';
```

### 3.3.4 预约表 (appointments)
```sql
CREATE TABLE appointments (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '预约ID',
  pet_id BIGINT NOT NULL COMMENT '宠物ID',
  doctor_id BIGINT NOT NULL COMMENT '医生ID',
  appointment_time DATETIME NOT NULL COMMENT '预约时间',
  status ENUM('PENDING', 'CONFIRMED', 'COMPLETED', 'CANCELLED') DEFAULT 'PENDING' COMMENT '预约状态',
  notes TEXT COMMENT '备注',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (pet_id) REFERENCES pets(id),
  FOREIGN KEY (doctor_id) REFERENCES doctors(id)
) COMMENT '预约表';
```

### 3.3.5 病例表 (medical_records)
```sql
CREATE TABLE medical_records (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '病例ID',
  pet_id BIGINT NOT NULL COMMENT '宠物ID',
  doctor_id BIGINT NOT NULL COMMENT '医生ID',
  appointment_id BIGINT COMMENT '预约ID',
  symptoms TEXT COMMENT '症状',
  diagnosis TEXT COMMENT '诊断',
  treatment TEXT COMMENT '治疗方案',
  notes TEXT COMMENT '备注',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (pet_id) REFERENCES pets(id),
  FOREIGN KEY (doctor_id) REFERENCES doctors(id),
  FOREIGN KEY (appointment_id) REFERENCES appointments(id)
) COMMENT '病例表';
```

### 3.3.6 药品表 (medicines)
```sql
CREATE TABLE medicines (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '药品ID',
  name VARCHAR(100) NOT NULL COMMENT '药品名称',
  description TEXT COMMENT '药品描述',
  price DECIMAL(10,2) NOT NULL COMMENT '价格',
  stock_quantity INT NOT NULL DEFAULT 0 COMMENT '库存数量',
  unit VARCHAR(20) COMMENT '单位',
  manufacturer VARCHAR(100) COMMENT '生产厂家',
  expiry_date DATE COMMENT '过期日期',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT '药品表';
```

### 3.3.7 处方表 (prescriptions)
```sql
CREATE TABLE prescriptions (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '处方ID',
  medical_record_id BIGINT NOT NULL COMMENT '病例ID',
  medicine_id BIGINT NOT NULL COMMENT '药品ID',
  quantity INT NOT NULL COMMENT '数量',
  dosage VARCHAR(100) COMMENT '用法用量',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (medical_record_id) REFERENCES medical_records(id),
  FOREIGN KEY (medicine_id) REFERENCES medicines(id)
) COMMENT '处方表';
```

### 3.3.8 收费表 (billing)
```sql
CREATE TABLE billing (
  id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '收费ID',
  pet_id BIGINT NOT NULL COMMENT '宠物ID',
  appointment_id BIGINT COMMENT '预约ID',
  total_amount DECIMAL(10,2) NOT NULL COMMENT '总金额',
  paid_amount DECIMAL(10,2) DEFAULT 0 COMMENT '已付金额',
  status ENUM('PENDING', 'PARTIAL', 'PAID') DEFAULT 'PENDING' COMMENT '支付状态',
  payment_method ENUM('CASH', 'CARD', 'ALIPAY', 'WECHAT') COMMENT '支付方式',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  FOREIGN KEY (pet_id) REFERENCES pets(id),
  FOREIGN KEY (appointment_id) REFERENCES appointments(id)
) COMMENT '收费表';
```

- 用户表：存储用户基本信息，包括用户名、密码、角色等
- 宠物表：存储宠物基本信息
- 医生表：存储医生基本信息和排班信息
- 预约表：存储预约相关信息
- 病例表：存储病例详细信息
- 药品表：存储药品信息
- 处方表：存储处方信息
- 收费表：存储收费信息

## 4. 项目结构

### 4.1 后端项目结构
```
src/main/java/edu/mycc/xhd/project
├── controller      # 控制层，处理HTTP请求
├── service         # 业务层，处理业务逻辑
├── dao/mapper      # 数据访问层，与数据库交互
├── entity/model    # 实体类，与数据库表对应
├── dto             # 数据传输对象
├── config          # 配置类
├── security        # 安全配置类
└── exception       # 异常处理类
```

后端安全配置示例：
```java
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig {

    @Autowired
    private JwtTokenProvider jwtTokenProvider;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf().disable()
            .authorizeRequests()
            .antMatchers("/api/auth/**").permitAll()
            .antMatchers("/api/users/**").hasAnyRole("USER", "RECEPTIONIST", "DOCTOR", "ADMIN")
            .antMatchers("/api/receptionist/**").hasRole("RECEPTIONIST")
            .antMatchers("/api/doctor/**").hasRole("DOCTOR")
            .antMatchers("/api/director/**").hasRole("ADMIN")
            .anyRequest().authenticated()
            .and()
            .apply(new JwtConfigurer(jwtTokenProvider));
        
        return http.build();
    }
}
```

### 4.2 前端项目结构
```
frontend/src
├── assets          # 静态资源文件
├── components      # 公共组件
├── views           # 页面组件
├── router          # 路由配置
├── store           # 状态管理
├── services        # API接口调用
├── utils           # 工具函数
└── guards          # 路由守卫
```

前端路由权限控制示例：
``javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router';
import { useUserStore } from '@/store/user';

const routes = [
  {
    path: '/user',
    component: () => import('@/views/user/Layout.vue'),
    beforeEnter: requireRole('USER'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/user/Dashboard.vue')
      },
      {
        path: 'appointments',
        component: () => import('@/views/user/Appointments.vue')
      }
    ]
  },
  {
    path: '/receptionist',
    component: () => import('@/views/receptionist/Layout.vue'),
    beforeEnter: requireRole('RECEPTIONIST'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/receptionist/Dashboard.vue')
      },
      {
        path: 'customers',
        component: () => import('@/views/receptionist/Customers.vue')
      }
    ]
  },
  {
    path: '/doctor',
    component: () => import('@/views/doctor/Layout.vue'),
    beforeEnter: requireRole('DOCTOR'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/doctor/Dashboard.vue')
      },
      {
        path: 'appointments',
        component: () => import('@/views/doctor/Appointments.vue')
      }
    ]
  },
  {
    path: '/director',
    component: () => import('@/views/director/Layout.vue'),
    beforeEnter: requireRole('ADMIN'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/director/Dashboard.vue')
      },
      {
        path: 'users',
        component: () => import('@/views/director/Users.vue')
      }
    ]
  }
];

function requireRole(role) {
  return (to, from, next) => {
    const userStore = useUserStore();
    if (userStore.role === role) {
      next();
    } else {
      next('/login');
    }
  };
}

const router = createRouter({
  history: createWebHistory(),
  routes
});

export default router;
```

## 5. 开发环境要求

### 5.1 后端环境
```

- JDK 17
- Maven 3.6+
- MySQL 8.0+
- IntelliJ IDEA

### 5.2 前端环境
- Node.js 16+
- VS Code或WebStorm
- npm或yarn

## 6. 部署方案

### 6.1 后端部署
- 使用Maven打包生成jar文件
- 部署到服务器运行

### 6.2 前端部署
- 使用npm run build打包
- 部署到Nginx或Apache服务器

## 7. 项目进度计划

| 阶段 | 内容 | 时间 |
|------|------|------|
| 第一阶段 | 需求分析、技术选型、数据库设计 | 1周 |
| 第二阶段 | 后端基础框架搭建、用户管理模块开发（含权限控制） | 2周 |
| 第三阶段 | 前端基础框架搭建、用户界面开发（含角色路由） | 2周 |
| 第四阶段 | 前台管理模块开发 | 2周 |
| 第五阶段 | 医生管理模块开发 | 2周 |
| 第六阶段 | 院长管理模块开发 | 2周 |
| 第七阶段 | 系统测试、Bug修复 | 1周 |
| 第八阶段 | 部署上线、文档完善 | 1周 |

## 8. 页面设计与实现

### 8.1 登录与注册页面

登录与注册页面是用户进入系统的入口，根据不同的角色进行权限区分。

#### 8.1.1 页面功能说明

1. 登录功能：
   - 用户输入用户名、密码和角色进行登录
   - 系统验证用户身份后根据角色跳转到相应页面
   - 提供"宠物主人"、"前台人员"、"医生"、"院长"四种角色选择

2. 注册功能：
   - 新用户可以注册为"宠物主人"角色
   - 需要填写用户名、密码、真实姓名、联系电话等信息
   - 注册成功后跳转到登录页面

#### 8.1.2 前端实现代码

登录注册页面组件 [frontend/src/views/Login.vue]：
``vue
<template>
  <div class="login-container">
    <div class="login-left">
      <div class="welcome-text">
        <h1>宠物医院信息管理系统</h1>
        <p>为您的宠物提供专业、便捷的医疗服务</p>
        <div class="features">
          <el-row :gutter="20">
            <el-col :span="12">
              <div class="feature-item">
                <i class="el-icon-guide feature-icon"></i>
                <span>宠物档案管理</span>
              </div>
            </el-col>
            <el-col :span="12">
              <div class="feature-item">
                <i class="el-icon-date feature-icon"></i>
                <span>在线预约挂号</span>
              </div>
            </el-col>
            <el-col :span="12">
              <div class="feature-item">
                <i class="el-icon-document feature-icon"></i>
                <span>电子病历记录</span>
              </div>
            </el-col>
            <el-col :span="12">
              <div class="feature-item">
                <i class="el-icon-money feature-icon"></i>
                <span>费用明细查询</span>
              </div>
            </el-col>
          </el-row>
        </div>
      </div>
    </div>
    <div class="login-right">
      <div class="login-form">
        <h2>{{ activeTab === 'login' ? '用户登录' : '用户注册' }}</h2>
        <el-tabs v-model="activeTab" @tab-change="handleTabChange">
          <el-tab-pane label="登录" name="login">
            <el-form :model="loginForm" :rules="loginRules" ref="loginFormRef" class="form">
              <el-form-item label="手机号/邮箱" prop="username">
                <el-input v-model="loginForm.username" placeholder="请输入手机号或邮箱" size="large" />
              </el-form-item>
              <el-form-item label="密码" prop="password">
                <el-input v-model="loginForm.password" type="password" placeholder="请输入密码" show-password size="large" />
              </el-form-item>
              <el-form-item label="角色" prop="role">
                <el-select v-model="loginForm.role" placeholder="请选择角色" style="width: 100%" size="large">
                  <el-option label="宠物主人" value="USER" />
                  <el-option label="前台人员" value="RECEPTIONIST" />
                  <el-option label="医生" value="DOCTOR" />
                  <el-option label="院长" value="ADMIN" />
                </el-select>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="handleLogin" :loading="loginLoading" style="width: 100%" size="large">
                  登录
                </el-button>
              </el-form-item>
            </el-form>
          </el-tab-pane>
          <el-tab-pane label="注册" name="register">
            <el-form :model="registerForm" :rules="registerRules" ref="registerFormRef" class="form">
              <el-form-item label="手机号/邮箱" prop="username">
                <el-input v-model="registerForm.username" placeholder="请输入手机号或邮箱" size="large" />
              </el-form-item>
              <el-form-item label="密码" prop="password">
                <el-input v-model="registerForm.password" type="password" placeholder="请输入密码" show-password size="large" />
              </el-form-item>
              <el-form-item label="确认密码" prop="confirmPassword">
                <el-input v-model="registerForm.confirmPassword" type="password" placeholder="请确认密码" show-password size="large" />
              </el-form-item>
              <el-form-item label="角色" prop="role">
                <el-select v-model="registerForm.role" placeholder="请选择角色" style="width: 100%" size="large">
                  <el-option label="宠物主人" value="USER" />
                  <el-option label="前台人员" value="RECEPTIONIST" />
                  <el-option label="医生" value="DOCTOR" />
                  <el-option label="院长" value="ADMIN" />
                </el-select>
              </el-form-item>
              <el-form-item>
                <el-button type="primary" @click="handleRegister" :loading="registerLoading" style="width: 100%" size="large">
                  注册
                </el-button>
              </el-form-item>
            </el-form>
          </el-tab-pane>
        </el-tabs>
      </div>
    </div>
  </div>
</template>

<script>
import api from '@/services/api';

export default {
  name: 'Login',
  data() {
    // 确认密码验证规则
    const validateConfirmPassword = (rule, value, callback) => {
      if (value !== this.registerForm.password) {
        callback(new Error('两次输入的密码不一致'));
      } else {
        callback();
      }
    };
    
    // 手机号/邮箱验证规则
    const validateUsername = (rule, value, callback) => {
      const phoneRegex = /^1[3-9]\d{9}$/;
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      
      if (phoneRegex.test(value) || emailRegex.test(value)) {
        callback();
      } else {
        callback(new Error('请输入有效的手机号或邮箱'));
      }
    };

    return {
      activeTab: 'login',
      loginLoading: false,
      registerLoading: false,
      loginForm: {
        username: '',
        password: '',
        role: 'USER'
      },
      registerForm: {
        username: '',
        password: '',
        confirmPassword: '',
        role: 'USER'
      },
      loginRules: {
        username: [
          { required: true, message: '请输入手机号或邮箱', trigger: 'blur' },
          { validator: validateUsername, trigger: 'blur' }
        ],
        password: [
          { required: true, message: '请输入密码', trigger: 'blur' }
        ],
        role: [
          { required: true, message: '请选择角色', trigger: 'change' }
        ]
      },
      registerRules: {
        username: [
          { required: true, message: '请输入手机号或邮箱', trigger: 'blur' },
          { validator: validateUsername, trigger: 'blur' }
        ],
        password: [
          { required: true, message: '请输入密码', trigger: 'blur' },
          { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
        ],
        confirmPassword: [
          { required: true, message: '请确认密码', trigger: 'blur' },
          { validator: validateConfirmPassword, trigger: 'blur' }
        ],
        role: [
          { required: true, message: '请选择角色', trigger: 'change' }
        ]
      }
    };
  },
  methods: {
    handleTabChange(tab) {
      this.activeTab = tab;
    },
    async handleLogin() {
      this.$refs.loginFormRef.validate(async (valid) => {
        if (valid) {
          this.loginLoading = true;
          try {
            const response = await api.post('/api/auth/login', this.loginForm);
            const { token, role } = response.data;
            
            // 存储token和用户信息
            localStorage.setItem('token', token);
            localStorage.setItem('userRole', role);
            
            // 根据角色跳转到不同页面
            this.redirectByRole(role);
            
            this.$message.success('登录成功');
          } catch (error) {
            this.$message.error('登录失败: ' + (error.response?.data || '未知错误'));
          } finally {
            this.loginLoading = false;
          }
        }
      });
    },
    async handleRegister() {
      this.$refs.registerFormRef.validate(async (valid) => {
        if (valid) {
          this.registerLoading = true;
          try {
            // 注册时只允许普通用户注册
            if (this.registerForm.role !== 'USER') {
              this.$message.error('只允许注册为宠物主人角色');
              return;
            }
            
            const response = await api.post('/api/auth/register', {
              username: this.registerForm.username,
              password: this.registerForm.password,
              role: this.registerForm.role
            });
            
            this.$message.success('注册成功，请登录');
            this.activeTab = 'login';
          } catch (error) {
            this.$message.error('注册失败: ' + (error.response?.data || '未知错误'));
          } finally {
            this.registerLoading = false;
          }
        }
      });
    },
    redirectByRole(role) {
      switch (role) {
        case 'USER':
          this.$router.push('/user/dashboard');
          break;
        case 'RECEPTIONIST':
import { useRouter } from 'vue-router';

export default {
  setup() {
    const router = useRouter();

    return {
      redirectUser(role) {
        switch (role) {
          case 'RECEPTIONIST':
            router.push('/receptionist/dashboard');
            break;
          case 'DOCTOR':
            router.push('/doctor/dashboard');
            break;
          case 'ADMIN':
            router.push('/director/dashboard');
            break;
          default:
            router.push('/');
        }
      }
    }
  }
};
</script>

<style scoped>
.login-container {
  display: flex;
  height: 100vh;
  background: linear-gradient(120deg, #e0c3fc, #8ec5fc);
}

.login-left {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px;
  color: white;
  background: rgba(0, 0, 0, 0.3);
}

.welcome-text h1 {
  font-size: 36px;
  margin-bottom: 20px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.welcome-text p {
  font-size: 18px;
  margin-bottom: 40px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.features {
  width: 100%;
}

.feature-item {
  display: flex;
  align-items: center;
  margin-bottom: 20px;
  font-size: 16px;
}

.feature-icon {
  font-size: 24px;
  margin-right: 10px;
  color: #ffd700;
}

.login-right {
  width: 500px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: white;
  padding: 40px;
  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
}

.login-form {
  width: 100%;
}

.login-form h2 {
  text-align: center;
  margin-bottom: 30px;
  color: #333;
  font-size: 28px;
}

.form {
  padding: 20px 0;
}

.form :deep(.el-form-item__label) {
  font-weight: bold;
  color: #555;
}

@media (max-width: 992px) {
  .login-left {
    display: none;
  }
  
  .login-right {
    width: 100%;
  }
}
</style>
```

路由配置 [frontend/src/router/index.js]：
```javascript
import { createRouter, createWebHistory } from 'vue-router';
import Login from '@/views/Login.vue';

// 用户路由
const userRoutes = [
  {
    path: '/user',
    component: () => import('@/views/user/Layout.vue'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/user/Dashboard.vue')
      }
    ]
  }
];

// 前台路由
const receptionistRoutes = [
  {
    path: '/receptionist',
    component: () => import('@/views/receptionist/Layout.vue'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/receptionist/Dashboard.vue')
      }
    ]
  }
];

// 医生路由
const doctorRoutes = [
  {
    path: '/doctor',
    component: () => import('@/views/doctor/Layout.vue'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/doctor/Dashboard.vue')
      }
    ]
  }
];

// 院长路由
const directorRoutes = [
  {
    path: '/director',
    component: () => import('@/views/director/Layout.vue'),
    children: [
      {
        path: 'dashboard',
        component: () => import('@/views/director/Dashboard.vue')
      }
    ]
  }
];

const routes = [
  {
    path: '/',
    redirect: '/login'
  },
  {
    path: '/login',
    component: Login
  },
  ...userRoutes,
  ...receptionistRoutes,
  ...doctorRoutes,
  ...directorRoutes
];

const router = createRouter({
  history: createWebHistory(),
  routes
});

// 路由守卫
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token');
  const userRole = localStorage.getItem('userRole');
  
  // 如果访问登录页，直接放行
  if (to.path === '/login') {
    next();
    return;
  }
  
  // 如果没有token，跳转到登录页
  if (!token) {
    next('/login');
    return;
  }
  
  // 根据角色放行对应路由
  if (to.path.startsWith('/user') && userRole === 'USER') {
    next();
  } else if (to.path.startsWith('/receptionist') && userRole === 'RECEPTIONIST') {
    next();
  } else if (to.path.startsWith('/doctor') && userRole === 'DOCTOR') {
    next();
  } else if (to.path.startsWith('/director') && userRole === 'ADMIN') {
    next();
  } else {
    // 角色与访问路径不匹配，跳转到登录页
    next('/login');
  }
});

export default router;
```

用户端主页面布局 [frontend/src/views/user/Layout.vue]：
``vue
<template>
  <div class="user-layout">
    <el-container>
      <el-header class="header">
        <div class="logo">宠物医院管理系统 - 用户端</div>
        <div class="user-info">
          <el-dropdown @command="handleCommand">
            <span class="el-dropdown-link">
              用户中心<i class="el-icon-arrow-down el-icon--right"></i>
            </span>
            <template #dropdown>
              <el-dropdown-menu>
                <el-dropdown-item command="logout">退出登录</el-dropdown-item>
              </el-dropdown-menu>
            </template>
          </el-dropdown>
        </div>
      </el-header>
      <el-container>
        <el-aside width="200px" class="aside">
          <el-menu
            :default-active="$route.path"
            class="menu"
            router
          >
            <el-menu-item index="/user/dashboard">
              <i class="el-icon-house"></i>
              <span>首页</span>
            </el-menu-item>
            <el-menu-item index="/user/appointments">
              <i class="el-icon-date"></i>
              <span>我的预约</span>
            </el-menu-item>
            <el-menu-item index="/user/pets">
              <i class="el-icon-guide"></i>
              <span>我的宠物</span>
            </el-menu-item>
            <el-menu-item index="/user/medical-records">
              <i class="el-icon-document"></i>
              <span>病例记录</span>
            </el-menu-item>
          </el-menu>
        </el-aside>
        <el-main class="main">
          <router-view />
        </el-main>
      </el-container>
    </el-container>
  </div>
</template>

<script>
export default {
  name: 'UserLayout',
  methods: {
    handleCommand(command) {
      if (command === 'logout') {
        // 清除本地存储的用户信息
        localStorage.removeItem('token');
        localStorage.removeItem('userRole');
        // 跳转到登录页
        this.$router.push('/login');
      }
    }
  }
};
</script>

<style scoped>
.user-layout {
  height: 100vh;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #409EFF;
  color: white;
  padding: 0 20px;
}

.logo {
  font-size: 18px;
  font-weight: bold;
}

.user-info {
  cursor: pointer;
}

.aside {
  background-color: #f5f5f5;
}

.menu {
  height: 100%;
  border-right: none;
}

.main {
  background-color: #fff;
  padding: 20px;
}
</style>
```

用户端首页 [frontend/src/views/user/Dashboard.vue]：
``vue
<template>
  <div class="dashboard">
    <el-card class="welcome-card">
      <div class="welcome-content">
        <h2>欢迎使用宠物医院信息管理系统</h2>
        <p>您已成功登录为宠物主人角色</p>
      </div>
    </el-card>
    
    <el-row :gutter="20" class="stats-row">
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-item">
            <i class="el-icon-guide stat-icon"></i>
            <div class="stat-info">
              <div class="stat-number">{{ petCount }}</div>
              <div class="stat-label">我的宠物</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-item">
            <i class="el-icon-date stat-icon"></i>
            <div class="stat-info">
              <div class="stat-number">{{ appointmentCount }}</div>
              <div class="stat-label">我的预约</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-item">
            <i class="el-icon-document stat-icon"></i>
            <div class="stat-info">
              <div class="stat-number">{{ recordCount }}</div>
              <div class="stat-label">病例记录</div>
            </div>
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-item">
            <i class="el-icon-chat-line-round stat-icon"></i>
            <div class="stat-info">
              <div class="stat-number">{{ messageCount }}</div>
              <div class="stat-label">未读消息</div>
            </div>
          </div>
        </el-card>
      </el-col>
    </el-row>
    
    <el-row :gutter="20">
      <el-col :span="16">
        <el-card class="recent-card">
          <template #header>
            <div class="card-header">
              <span>最近预约</span>
            </div>
          </template>
          <el-table :data="recentAppointments" style="width: 100%">
            <el-table-column prop="date" label="预约时间" width="180"></el-table-column>
            <el-table-column prop="pet" label="宠物" width="120"></el-table-column>
            <el-table-column prop="doctor" label="医生" width="120"></el-table-column>
            <el-table-column prop="status" label="状态">
              <template #default="scope">
                <el-tag :type="getStatusType(scope.row.status)">{{ scope.row.status }}</el-tag>
              </template>
            </el-table-column>
          </el-table>
        </el-card>
      </el-col>
      <el-col :span="8">
        <el-card class="notice-card">
          <template #header>
            <div class="card-header">
              <span>医院公告</span>
            </div>
          </template>
          <ul class="notice-list">
            <li v-for="notice in notices" :key="notice.id" class="notice-item">
              <div class="notice-title">{{ notice.title }}</div>
              <div class="notice-date">{{ notice.date }}</div>
            </li>
          </ul>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>

<script>
export default {
  name: 'UserDashboard',
  data() {
    return {
      petCount: 2,
      appointmentCount: 3,
      recordCount: 5,
      messageCount: 1,
      recentAppointments: [
        {
          date: '2023-06-15 14:30',
          pet: '小白',
          doctor: '张医生',
          status: '已完成'
        },
        {
          date: '2023-06-20 10:00',
          pet: '小黑',
          doctor: '李医生',
          status: '已确认'
        },
        {
          date: '2023-06-25 15:00',
          pet: '小白',
          doctor: '王医生',
          status: '待确认'
        }
      ],
      notices: [
        {
          id: 1,
          title: '端午节放假通知',
          date: '2023-06-10'
        },
        {
          id: 2,
          title: '疫苗接种优惠活动',
          date: '2023-06-05'
        },
        {
          id: 3,
          title: '新增宠物寄养服务',
          date: '2023-06-01'
        }
      ]
    };
  },
  methods: {
    getStatusType(status) {
      const statusMap = {
        '已完成': 'success',
        '已确认': 'warning',
        '待确认': 'info',
        '已取消': 'danger'
      };
      return statusMap[status] || 'info';
    }
  }
};
</script>

<style scoped>
.dashboard {
  padding: 20px;
}

.welcome-card {
  margin-bottom: 20px;
}

.welcome-content {
  text-align: center;
  padding: 20px 0;
}

.welcome-content h2 {
  margin-bottom: 10px;
  color: #333;
}

.stats-row {
  margin-bottom: 20px;
}

.stat-card {
  height: 120px;
}

.stat-item {
  display: flex;
  align-items: center;
  height: 100%;
}

.stat-icon {
  font-size: 40px;
  color: #409EFF;
  margin: 0 20px;
}

.stat-info {
  text-align: center;
}

.stat-number {
  font-size: 24px;
  font-weight: bold;
  color: #333;
}

.stat-label {
  font-size: 14px;
  color: #666;
}

.recent-card,
.notice-card {
  margin-top: 20px;
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notice-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.notice-item {
  padding: 10px 0;
  border-bottom: 1px solid #eee;
}

.notice-item:last-child {
  border-bottom: none;
}

.notice-title {
  font-size: 14px;
  color: #333;
  margin-bottom: 5px;
}

.notice-date {
  font-size: 12px;
  color: #999;
}
</style>
```

#### 8.1.3 页面功能说明

1. 登录页面功能：
   - 提供用户名、密码和角色选择的登录表单
   - 提供注册新用户的选项卡
   - 根据用户选择的角色进行权限验证和页面跳转
   - 使用Element Plus组件库构建美观的UI界面

2. 权限控制：
   - 前端路由守卫根据用户角色控制页面访问权限
   - 不同角色登录后跳转到不同的主页面
   - 通过localStorage存储用户认证信息

3. 用户端主页面：
   - 提供侧边栏导航菜单
   - 显示用户相关信息和统计数据
   - 展示最近预约和医院公告等信息

4. 用户体验：
   - 响应式设计，适配不同屏幕尺寸
   - 表单验证确保输入数据的正确性
   - 加载状态提示提升用户交互体验
# 宠物医院信息管理系统开发文档

## 1. 系统概述

宠物医院信息管理系统是一个专门为宠物医院设计的综合管理平台，旨在提高医院运营效率，优化客户体验，简化医生工作流程，并为管理层提供数据分析支持。

### 1.1 系统目标
- 为宠物主人提供便捷的预约服务和宠物健康管理功能
- 为前台工作人员提供客户和宠物档案管理、预约挂号、收费结算等功能
- 为医生提供排班查看、接诊管理、病例记录等功能
- 为院长提供全面的数据统计和报表分析功能

### 1.2 技术架构
- 前端层：Vue.js
- 业务逻辑层：Spring Boot后端RESTful API接口
- 数据访问层：MyBatis/MyBatis Plus + 数据库连接池
- 数据存储层：MySQL

## 2. 功能模块设计

### 2.1 用户管理模块

#### 2.1.1 登录和注册
- 用户注册：新用户可以通过手机号或邮箱注册账户
- 用户登录：已注册用户可通过手机号或邮箱及密码登录系统
- 身份验证：JWT Token验证用户身份
- 角色权限控制：根据用户角色类别分配不同权限，登录成功后跳转到相应角色的主页面
- 个人信息完善：注册时仅需提供手机号/邮箱和密码，真实姓名等详细信息在登录后个人资料中完善

##### 关键代码示例

后端登录接口示例：
``java
@RestController
@RequestMapping("/api/auth")
public class AuthController {

    @Autowired
    private UserService userService;

    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody LoginRequest loginRequest) {
        try {
            Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(
                    loginRequest.getUsername(),
                    loginRequest.getPassword()
                )
            );
            
            String token = jwtTokenProvider.generateToken(authentication);
            User user = userService.findByUsername(loginRequest.getUsername());
            
            LoginResponse response = new LoginResponse();
            response.setToken(token);
            response.setRole(user.getRole());
            response.setUserId(user.getId());
            
            return ResponseEntity.ok(response);
        } catch (AuthenticationException e) {
            return ResponseEntity.status(HttpStatus.UNAUTHORIZED).body("登录失败");
        }
    }
}
```

前端登录处理示例：
```
// 登录方法
const login = async (username, password) => {
  try {
    const response = await axios.post('/api/auth/login', { username, password });
    const { token, role } = response.data;
    
    // 存储token
    localStorage.setItem('token', token);
    
    // 根据角色跳转到不同页面
    switch(role) {
      case 'USER':
        router.push('/user/dashboard');
        break;
      case 'RECEPTIONIST':
        router.push('/receptionist/dashboard');
        break;
      case 'DOCTOR':
        router.push('/doctor/dashboard');
        break;
      case 'ADMIN':
        router.push('/director/dashboard');
        break;
      default:
        router.push('/');
    }
    
    return { success: true };
  } catch (error) {
    return { success: false, message: '登录失败' };
  }
};
```

#### 2.1.2 预约功能
- 在线预约：用户可以选择医生、时间进行预约
- 预约查询：用户可以查看自己的预约记录
- 预约修改：用户可以修改或取消预约

##### 关键代码示例

后端预约接口示例：
```java
@RestController
@RequestMapping("/api/appointments")
@PreAuthorize("hasRole('USER')")
public class AppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @PostMapping
    public ResponseEntity<?> createAppointment(@RequestBody AppointmentRequest request) {
        try {
            Appointment appointment = appointmentService.createAppointment(request);
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约失败: " + e.getMessage());
        }
    }

    @GetMapping("/user/{userId}")
    public ResponseEntity<?> getUserAppointments(@PathVariable Long userId) {
        List<Appointment> appointments = appointmentService.getUserAppointments(userId);
        return ResponseEntity.ok(appointments);
    }
}
```

前端预约组件示例：
``vue
<template>
  <div class="appointment-form">
    <el-form :model="appointmentForm" label-width="120px">
      <el-form-item label="选择宠物">
        <el-select v-model="appointmentForm.petId" placeholder="请选择宠物">
          <el-option
            v-for="pet in pets"
            :key="pet.id"
            :label="pet.name"
            :value="pet.id">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="选择医生">
        <el-select v-model="appointmentForm.doctorId" placeholder="请选择医生">
          <el-option
            v-for="doctor in doctors"
            :key="doctor.id"
            :label="doctor.name"
            :value="doctor.id">
          </el-option>
        </el-select>
      </el-form-item>
      <el-form-item label="预约时间">
        <el-date-picker
          v-model="appointmentForm.appointmentTime"
          type="datetime"
          placeholder="选择日期时间">
        </el-date-picker>
      </el-form-item>
      <el-form-item>
        <el-button type="primary" @click="submitAppointment">提交预约</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      appointmentForm: {
        petId: '',
        doctorId: '',
        appointmentTime: ''
      },
      pets: [],
      doctors: []
    };
  },
  
  methods: {
    async submitAppointment() {
      try {
        const response = await axios.post('/api/appointments', this.appointmentForm);
        this.$message.success('预约成功');
        this.$router.push('/user/appointments');
      } catch (error) {
        this.$message.error('预约失败: ' + error.response.data);
      }
    }
  }
};
</script>
```

#### 2.1.3 个人宠物既往病例查看
- 宠物档案：用户可以查看自己宠物的基本信息
- 病例查看：用户可以查看宠物的历史就诊记录和病例详情

##### 关键代码示例

后端病例查询接口示例：
```java
@RestController
@RequestMapping("/api/medical-records")
@PreAuthorize("hasRole('USER')")
public class MedicalRecordController {

    @Autowired
    private MedicalRecordService medicalRecordService;

    @GetMapping("/pet/{petId}")
    public ResponseEntity<?> getPetMedicalRecords(@PathVariable Long petId) {
        List<MedicalRecord> records = medicalRecordService.getPetMedicalRecords(petId);
        return ResponseEntity.ok(records);
    }
}
```

前端病例展示组件示例：
``vue
<template>
  <div class="medical-records">
    <el-table :data="medicalRecords" style="width: 100%">
      <el-table-column prop="visitDate" label="就诊日期" width="180"></el-table-column>
      <el-table-column prop="symptoms" label="症状" width="200"></el-table-column>
      <el-table-column prop="diagnosis" label="诊断结果"></el-table-column>
      <el-table-column prop="treatment" label="治疗方案"></el-table-column>
      <el-table-column label="操作" width="100">
        <template #default="scope">
          <el-button @click="viewDetail(scope.row.id)" type="text">查看详情</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      medicalRecords: []
    };
  },
  
  async mounted() {
    await this.loadMedicalRecords();
  },
  
  methods: {
    async loadMedicalRecords() {
      try {
        const petId = this.$route.params.petId;
        const response = await axios.get(`/api/medical-records/pet/${petId}`);
        this.medicalRecords = response.data;
      } catch (error) {
        this.$message.error('加载病例失败');
      }
    },
    
    viewDetail(recordId) {
      this.$router.push(`/user/medical-record/${recordId}`);
    }
  }
};
</script>
```

### 2.2 前台管理模块

#### 2.2.1 客户与宠物档案管理
- 客户信息管理：维护客户基本信息、联系方式等
- 宠物档案管理：维护宠物基本信息、品种、年龄、疫苗记录等

##### 关键代码示例

后端客户管理接口示例：
```java
@RestController
@RequestMapping("/api/customers")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class CustomerController {

    @Autowired
    private CustomerService customerService;

    @GetMapping
    public ResponseEntity<?> getAllCustomers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
        Page<Customer> customers = customerService.getAllCustomers(PageRequest.of(page, size));
        return ResponseEntity.ok(customers);
    }

    @PostMapping
    public ResponseEntity<?> createCustomer(@RequestBody Customer customer) {
        Customer savedCustomer = customerService.saveCustomer(customer);
        return ResponseEntity.ok(savedCustomer);
    }

    @PutMapping("/{id}")
    public ResponseEntity<?> updateCustomer(@PathVariable Long id, @RequestBody Customer customer) {
        Customer updatedCustomer = customerService.updateCustomer(id, customer);
        return ResponseEntity.ok(updatedCustomer);
    }
}
```

前端客户管理界面示例：
``vue
<template>
  <div class="customer-management">
    <el-card>
      <div slot="header">
        <span>客户档案管理</span>
        <el-button style="float: right;" type="primary" @click="showAddForm">新增客户</el-button>
      </div>
      
      <el-table :data="customers" style="width: 100%">
        <el-table-column prop="realName" label="姓名" width="120"></el-table-column>
        <el-table-column prop="phone" label="电话" width="150"></el-table-column>
        <el-table-column prop="email" label="邮箱" width="200"></el-table-column>
        <el-table-column label="操作">
          <template #default="scope">
            <el-button size="mini" @click="editCustomer(scope.row)">编辑</el-button>
            <el-button size="mini" type="danger" @click="deleteCustomer(scope.row.id)">删除</el-button>
          </template>
        </el-table-column>
      </el-table>
      
      <el-pagination
        @size-change="handleSizeChange"
        @current-change="handleCurrentChange"
        :current-page="currentPage"
        :page-sizes="[10, 20, 50]"
        :page-size="pageSize"
        layout="total, sizes, prev, pager, next, jumper"
        :total="total">
      </el-pagination>
    </el-card>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      customers: [],
      currentPage: 1,
      pageSize: 10,
      total: 0
    };
  },
  
  mounted() {
    this.loadCustomers();
  },
  
  methods: {
    async loadCustomers() {
      try {
        const response = await axios.get(`/api/customers?page=${this.currentPage - 1}&size=${this.pageSize}`);
        this.customers = response.data.content;
        this.total = response.data.totalElements;
      } catch (error) {
        this.$message.error('加载客户数据失败');
      }
    },
    
    handleSizeChange(val) {
      this.pageSize = val;
      this.loadCustomers();
    },
    
    handleCurrentChange(val) {
      this.currentPage = val;
      this.loadCustomers();
    }
  }
};
</script>
```

#### 2.2.2 预约挂号管理
- 预约登记：为现场客户提供预约服务
- 预约调整：修改预约时间或医生
- 预约取消：处理客户取消预约请求

##### 关键代码示例

后端预约管理接口示例：
``java
@RestController
@RequestMapping("/api/receptionist/appointments")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class ReceptionistAppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @PostMapping
    public ResponseEntity<?> createAppointment(@RequestBody AppointmentRequest request) {
        try {
            Appointment appointment = appointmentService.createAppointmentByReceptionist(request);
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约登记失败: " + e.getMessage());
        }
    }

    @PutMapping("/{id}/reschedule")
    public ResponseEntity<?> rescheduleAppointment(@PathVariable Long id, @RequestBody RescheduleRequest request) {
        try {
            Appointment appointment = appointmentService.rescheduleAppointment(id, request.getNewTime());
            return ResponseEntity.ok(appointment);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("预约调整失败: " + e.getMessage());
        }
    }

    @DeleteMapping("/{id}/cancel")
    public ResponseEntity<?> cancelAppointment(@PathVariable Long id) {
        try {
            appointmentService.cancelAppointment(id);
            return ResponseEntity.ok("预约已取消");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("取消预约失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.3 收费结算
- 费用计算：根据诊疗项目和药品自动生成费用清单
- 收费处理：支持多种支付方式（现金、刷卡、移动支付）
- 发票打印：生成并打印收费发票

##### 关键代码示例

后端收费接口示例：
``java
@RestController
@RequestMapping("/api/billing")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class BillingController {

    @Autowired
    private BillingService billingService;

    @PostMapping
    public ResponseEntity<?> createBill(@RequestBody BillingRequest request) {
        try {
            Billing bill = billingService.createBill(request);
            return ResponseEntity.ok(bill);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("创建账单失败: " + e.getMessage());
        }
    }

    @PostMapping("/{id}/pay")
    public ResponseEntity<?> processPayment(
        @PathVariable Long id, 
        @RequestBody PaymentRequest request) {
        try {
            Billing updatedBill = billingService.processPayment(id, request);
            return ResponseEntity.ok(updatedBill);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("支付处理失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.4 药品出入库登记
- 入库登记：记录药品采购信息
- 出库登记：记录药品使用或销售信息
- 库存更新：实时更新药品库存数量

##### 关键代码示例

后端药品库存管理接口示例：
``java
@RestController
@RequestMapping("/api/medicine-inventory")
@PreAuthorize("hasRole('RECEPTIONIST')")
public class MedicineInventoryController {

    @Autowired
    private MedicineInventoryService inventoryService;

    @PostMapping("/inbound")
    public ResponseEntity<?> recordInbound(@RequestBody InboundRequest request) {
        try {
            inventoryService.recordInbound(request);
            return ResponseEntity.ok("入库登记成功");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("入库登记失败: " + e.getMessage());
        }
    }

    @PostMapping("/outbound")
    public ResponseEntity<?> recordOutbound(@RequestBody OutboundRequest request) {
        try {
            inventoryService.recordOutbound(request);
            return ResponseEntity.ok("出库登记成功");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("出库登记失败: " + e.getMessage());
        }
    }
}
```

#### 2.2.5 预约提醒与客户通知
- 短信提醒：在预约前一天发送提醒短信
- 电话通知：重要事项电话通知客户
- 系统提醒：在系统内发送站内信提醒

##### 关键代码示例

定时任务发送提醒示例：
``java
@Component
public class AppointmentReminderService {

    @Autowired
    private AppointmentRepository appointmentRepository;
    
    @Autowired
    private NotificationService notificationService;

    @Scheduled(cron = "0 0 9 * * ?") // 每天上午9点执行
    public void sendAppointmentReminders() {
        LocalDate tomorrow = LocalDate.now().plusDays(1);
        List<Appointment> appointments = appointmentRepository
            .findByAppointmentTimeBetween(
                tomorrow.atStartOfDay(), 
                tomorrow.atTime(23, 59, 59));
        
        for (Appointment appointment : appointments) {
            // 发送短信提醒
            notificationService.sendSmsReminder(appointment);
            
            // 发送系统提醒
            notificationService.sendSystemNotification(appointment);
        }
    }
}
```

### 2.3 医生管理模块

#### 2.3.1 我的排班
- 排班查看：医生可以查看个人排班时间表
- 排班调整申请：医生可以申请调整排班时间

##### 关键代码示例

后端排班管理接口示例：
``java
@RestController
@RequestMapping("/api/doctor/schedule")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorScheduleController {

    @Autowired
    private DoctorScheduleService scheduleService;

    @GetMapping
    public ResponseEntity<?> getMySchedule(Authentication authentication) {
        User currentUser = (User) authentication.getPrincipal();
        List<Schedule> schedules = scheduleService.getDoctorSchedules(currentUser.getId());
        return ResponseEntity.ok(schedules);
    }

    @PostMapping("/request-change")
    public ResponseEntity<?> requestScheduleChange(@RequestBody ScheduleChangeRequest request) {
        try {
            scheduleService.requestScheduleChange(request);
            return ResponseEntity.ok("排班调整申请已提交");
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("申请提交失败: " + e.getMessage());
        }
    }
}
```

#### 2.3.2 接诊与病理管理
- 接诊处理：医生可以查看当日预约患者并进行接诊
- 病理记录：记录诊断结果、治疗方案等信息

##### 关键代码示例

后端接诊接口示例：
``java
@RestController
@RequestMapping("/api/doctor/consultation")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorConsultationController {

    @Autowired
    private ConsultationService consultationService;

    @GetMapping("/today")
    public ResponseEntity<?> getTodayAppointments(Authentication authentication) {
        User currentUser = (User) authentication.getPrincipal();
        List<Appointment> appointments = consultationService.getDoctorTodayAppointments(currentUser.getId());
        return ResponseEntity.ok(appointments);
    }

    @PostMapping("/record")
    public ResponseEntity<?> recordConsultation(@RequestBody ConsultationRecordRequest request) {
        try {
            MedicalRecord record = consultationService.recordConsultation(request);
            return ResponseEntity.ok(record);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("记录失败: " + e.getMessage());
        }
    }
}
```

#### 2.3.3 处方与药品关联
- 处方开具：医生可以为患者开具电子处方
- 药品关联：处方自动关联所需药品和剂量

##### 关键代码示例

后端处方管理接口示例：
``java
@RestController
@RequestMapping("/api/doctor/prescription")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorPrescriptionController {

    @Autowired
    private PrescriptionService prescriptionService;

    @PostMapping
    public ResponseEntity<?> createPrescription(@RequestBody PrescriptionRequest request) {
        try {
            Prescription prescription = prescriptionService.createPrescription(request);
            return ResponseEntity.ok(prescription);
        } catch (Exception e) {
            return ResponseEntity.badRequest().body("处方开具失败: " + e.getMessage());
        }
    }

    @GetMapping("/medical-record/{recordId}")
    public ResponseEntity<?> getPrescriptionsByMedicalRecord(@PathVariable Long recordId) {
        List<Prescription> prescriptions = prescriptionService.getByMedicalRecordId(recordId);
        return ResponseEntity.ok(prescriptions);
    }
}
```

#### 2.3.4 历史病例查阅
- 病例查询：医生可以查询历史病例记录
- 病例对比：可以对比同一宠物多次就诊记录

##### 关键代码示例

后端病例查询接口示例：
``java
@RestController
@RequestMapping("/api/doctor/medical-records")
@PreAuthorize("hasRole('DOCTOR')")
public class DoctorMedicalRecordController {

    @Autowired
    private MedicalRecordService medicalRecordService;

    @GetMapping("/pet/{petId}")
    public ResponseEntity<?> getPetMedicalHistory(@PathVariable Long petId) {
        List<MedicalRecord> records = medicalRecordService.getPetMedicalHistory(petId);
        return ResponseEntity.ok(records);
    }

    @GetMapping("/compare")
    public ResponseEntity<?> compareMedicalRecords(@RequestParam List<Long> recordIds) {
        List<MedicalRecord> records = medicalRecordService.compareRecords(recordIds);
        return ResponseEntity.ok(records);
    }
}
```

#### 2.3.5 预约列表
- 当日预约：查看当日所有预约信息
- 预约状态更新：更新预约就诊状态

##### 关键代码示例

前端预约列表组件示例：
``vue
<template>
  <div class="appointment-list">
    <el-card>
      <div slot="header">
        <span>今日预约列表</span>
      </div>
      
      <el-table :data="appointments" style="width: 100%">
        <el-table-column prop="petName" label="宠物名称" width="120"></el-table-column>
        <el-table-column prop="ownerName" label="主人姓名" width="120"></el-table-column>
        <el-table-column prop="appointmentTime" label="预约时间" width="180"></el-table-column>
        <el-table-column prop="status" label="状态" width="100">
          <template #default="scope">
            <el-tag :type="getStatusTagType(scope.row.status)">
              {{ getStatusText(scope.row.status) }}
            </el-tag>
          </template>
        </el-table-column>
        <el-table-column label="操作">
          <template #default="scope">
            <el-button 
              size="mini" 
              @click="updateStatus(scope.row.id, 'CONFIRMED')" 
              :disabled="scope.row.status !== 'PENDING'">
              接诊
            </el-button>
            <el-button 
              size="mini" 
              type="success" 
              @click="updateStatus(scope.row.id, 'COMPLETED')" 
              :disabled="scope.row.status !== 'CONFIRMED'">
              完成
            </el-button>
          </template>
        </el-table-column>
      </el-table>
    </el-card>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      appointments: []
    };
  },
  
  mounted() {
    this.loadTodayAppointments();
  },
  
  methods: {
    async loadTodayAppointments() {
      try {
        const response = await axios.get('/api/doctor/consultation/today');
        this.appointments = response.data;
      } catch (error) {
        this.$message.error('加载预约列表失败');
      }
    },
    
    async updateStatus(appointmentId, status) {
      try {
        await axios.put(`/api/appointments/${appointmentId}/status`, { status });
        this.$message.success('状态更新成功');
        this.loadTodayAppointments();
      } catch (error) {
        this.$message.error('状态更新失败');
      }
    },
    
    getStatusTagType(status) {
      const statusMap = {
        'PENDING': '',
        'CONFIRMED': 'warning',
        'COMPLETED': 'success',
        'CANCELLED': 'danger'
      };
      return statusMap[status] || '';
    },
    
    getStatusText(status) {
      const statusTextMap = {
        'PENDING': '待接诊',
        'CONFIRMED': '已接诊',
        'COMPLETED': '已完成',
        'CANCELLED': '已取消'
      };
      return statusTextMap[status] || status;
    }
  }
};
</script>
```

### 2.4 院长管理模块

#### 2.4.1 用户管理
- 用户权限管理：管理不同角色用户的权限
- 用户信息维护：维护系统所有用户的基本信息

##### 关键代码示例

后端用户管理接口示例：
``java